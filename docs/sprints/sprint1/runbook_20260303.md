# 2026.03.03 Runbook（Supabase 認証・Web 設定反映）

### 1.1.6.4 JWKS URL / issuer / audience の確定

このリポジトリでは Supabase JWT 検証パラメータを以下で固定します。

- `SUPABASE_JWKS_URL`: `https://bekltsvemtvbjxwrqvxg.supabase.co/auth/v1/.well-known/jwks.json`
- `SUPABASE_ISSUER`: `https://bekltsvemtvbjxwrqvxg.supabase.co/auth/v1`
- `SUPABASE_AUDIENCE`: `authenticated`

反映箇所:
- `apps/api/wrangler.toml`（staging / production vars）
- `apps/api/src/types/env.ts`（Env型）
- `apps/api/scripts/verify-jwt.mjs`（検証サンプル）

### 1.5.2 / 1.5.2.1 / 1.5.2.2 Web（Pages）設定反映

Web 側で次の設定キーを利用可能にしています（`apps/web/pages/lib/client.js`）。

- `SHADOWNAV_API_BASE`（既定: `https://api.shadowwork-navigator.com`）
- `SHADOWNAV_SUPABASE_URL`
- `SHADOWNAV_SUPABASE_ANON_KEY`

一時反映（ブラウザ Console）:

```js
localStorage.setItem("SHADOWNAV_API_BASE", "https://api.shadowwork-navigator.com");
localStorage.setItem("SHADOWNAV_SUPABASE_URL", "https://bekltsvemtvbjxwrqvxg.supabase.co");
localStorage.setItem("SHADOWNAV_SUPABASE_ANON_KEY", "<SUPABASE_ANON_KEY>");
location.reload();
```

### 1.6.1 Workers（staging/production）のVars/Secrets反映確認

1) Secrets の登録有無を確認

```bash
cd apps/api
pnpm exec wrangler secret list --env staging
pnpm exec wrangler secret list --env production
```

2) Vars は `apps/api/wrangler.toml` の `env.staging.vars` / `env.production.vars` を確認

03.03時点で確認対象に含める値:
- `ALLOWED_ORIGINS`
- `JWT_ISSUER`, `JWT_AUDIENCE`, `ACCESS_TOKEN_TTL_SECONDS`
- `SUPABASE_URL`, `SUPABASE_JWKS_URL`, `SUPABASE_ISSUER`, `SUPABASE_AUDIENCE`
